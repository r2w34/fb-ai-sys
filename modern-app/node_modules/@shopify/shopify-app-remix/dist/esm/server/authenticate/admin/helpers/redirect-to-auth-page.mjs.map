{"version":3,"file":"redirect-to-auth-page.mjs","sources":["../../../../../../../src/server/authenticate/admin/helpers/redirect-to-auth-page.ts"],"sourcesContent":["import type {BasicParams} from '../../../types';\n\nimport {beginAuth} from './begin-auth';\nimport {redirectWithExitIframe} from './redirect-with-exitiframe';\nimport {redirectWithAppBridgeHeaders} from './redirect-with-app-bridge-headers';\n\nexport async function redirectToAuthPage(\n  params: BasicParams,\n  request: Request,\n  shop: string,\n  isOnline = false,\n): Promise<never> {\n  const {config} = params;\n\n  const url = new URL(request.url);\n  const isEmbeddedRequest = url.searchParams.get('embedded') === '1';\n  const isXhrRequest = request.headers.get('authorization');\n\n  if (isXhrRequest) {\n    const redirectUri = new URL(config.auth.path, config.appUrl);\n    redirectUri.searchParams.set('shop', shop);\n    redirectWithAppBridgeHeaders(redirectUri.toString());\n  } else if (isEmbeddedRequest) {\n    redirectWithExitIframe(params, request, shop);\n  } else {\n    throw await beginAuth(params, request, isOnline, shop);\n  }\n}\n"],"names":[],"mappings":";;;;AAMO,eAAe,kBAAkB,CACtC,MAAmB,EACnB,OAAgB,EAChB,IAAY,EACZ,QAAQ,GAAG,KAAK,EAAA;AAEhB,IAAA,MAAM,EAAC,MAAM,EAAC,GAAG,MAAM;IAEvB,MAAM,GAAG,GAAG,IAAI,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC;AAChC,IAAA,MAAM,iBAAiB,GAAG,GAAG,CAAC,YAAY,CAAC,GAAG,CAAC,UAAU,CAAC,KAAK,GAAG;IAClE,MAAM,YAAY,GAAG,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC,eAAe,CAAC;IAEzD,IAAI,YAAY,EAAE;AAChB,QAAA,MAAM,WAAW,GAAG,IAAI,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,EAAE,MAAM,CAAC,MAAM,CAAC;QAC5D,WAAW,CAAC,YAAY,CAAC,GAAG,CAAC,MAAM,EAAE,IAAI,CAAC;AAC1C,QAAA,4BAA4B,CAAC,WAAW,CAAC,QAAQ,EAAE,CAAC;IACtD;SAAO,IAAI,iBAAiB,EAAE;AAC5B,QAAA,sBAAsB,CAAC,MAAM,EAAE,OAAO,EAAE,IAAI,CAAC;IAC/C;SAAO;QACL,MAAM,MAAM,SAAS,CAAC,MAAM,EAAE,OAAO,EAAE,QAAQ,EAAE,IAAI,CAAC;IACxD;AACF;;;;"}